---
title: "Manejo de encuestas con tidyverse: Caso de estudio sobre la ENESEM"
subtitle: "Webinar ERGOSTATS"
author: "Alex Baja√±a"
format: 
  revealjs:
    incremental: true 
editor: visual
chalkboard: true
---

# Introducci√≥n a la ciencia de datos

## Principio de reproducibilidad

-   ¬øLas tablas y figuras son reproducibles a partir del c√≥digo y los datos?
-   ¬øEl c√≥digo realmente hace lo que crees que hace?
-   Adem√°s de lo que se hizo, ¬øest√° claro por qu√© se hizo? Por ejemplo, ¬øc√≥mo se eligieron las configuraciones de los par√°metros?

## A√∫n m√°s lejos

-   ¬øEs posible extender el c√≥digo a otro conjunto de datos?
-   ¬øSi me cambio de computador puedo reejecutar el c√≥digo sin mayores configuraciones salvo por la instalaci√≥n?

## Principio de `tidy data`

![](images/paste-EBD6F253.png)

-   Cada variable debe tener su propia columna.

-   Cada observaci√≥n debe tener su propia fila.

-   Cada valor debe tener su propia celda.

## Ejecuci√≥n de c√≥digo

![](images/paste-45B29C2B.png)

## Busqueda de ayuda

-   Abrir una ventana de ayuda:

```{r eval =FALSE, echo=TRUE}

help.start()

```

-   Buscar informaci√≥n acerca de un tema espec√≠fico:

```{r eval =FALSE, echo=TRUE}

help.search("‚Ä¶")
```

-   Buscar ayuda sobre una funci√≥n:

```{r eval = FALSE, echo=TRUE}

help(‚Ä¶)

?‚Ä¶



```

## Busqueda de ayuda

Vi√±etas:

-   Buscar vi√±etas disponibles: `vignete()`

-   Buscar una vi√±eta espec√≠fica: `vignette("‚Ä¶")`

Web:

-   [Stackoverflow](https://stackoverflow.com)

-   [Rpubs](https://rpubs.com/)

-   [Mailing List](https://www.r-project.org/mail.html)

-   [Github](https://github.com/trending/r)

> Recuerda que R es en primera instancia un software de car√°cter estad√≠stico, los temas de ayuda incrementan a medida que cargues librerias.

## Vamos a hacer una equivalencia entre java y R antes de empezar

Una parte de c√≥digo provista por sus compa√±eros:

```{java eval = FALSE, echo=TRUE}

@SuppressLint("MissingInflatedId")
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        temperatur = (EditText) findViewById(R.id.txttemperatur);
    }
    
public void abrirSignosm (View vista) {
 String valortemper, valorpeso1, valorpresion1;

if (temper < 36) {
            valortemper = "Temperatura bajo de lo normal HIPOTERMIA";
        } else if (temper >= 36 && temper <= 37) {
            valortemper = "Temperatura normal";
        } else {
            valortemper = "Temperatura rebasa los limites : Fiebre";
        }

```

## Ahora veamolo en R

```{r eval=FALSE, echo=TRUE}

valortemper <- 50

if (temper < 36 & is.numeric(valortemper)) {
            valortemper = "Temperatura bajo de lo normal HIPOTERMIA";
        } else if (temper >= 36 & temper <= 37) {
            valortemper = "Temperatura normal";
        } else {
            valortemper = "Temperatura rebasa los limites : Fiebre";
        }
```

> La diferencia es que en R todo se trabaja con objetos y se guardan en la memoria RAM (ojo)

## Las tecnolog√≠as de la informaci√≥n

> *Luego de m√°s de una d√©cada de pol√≠ticas para impulsar un mayor acceso y uso de estas tecnolog√≠as, los pa√≠ses de Am√©rica Latina y el Caribe han logrado avances significativos (...) no obstante, avanzan a velocidades distintas y con grandes brechas, tanto entre ellos como en el interior de cada uno, adem√°s de con fuertes rezagos respecto de las econom√≠as m√°s desarrolladas.*[^1]

[^1]: https://www.cepal.org/es/temas/tecnologias-de-la-informacion-y-las-comunicaciones-tic/acerca-tecnologias-la-informacion

## Puntos preliminaresüåü

::: {align="center"}
**!Gracias por asistir a este webinar¬°**
:::

-   El webinar est√° planeado para tener una duraci√≥n de **1h45min**

-   En cualquier momento puedes alzar (en Zoom) la mano para hacernos preguntas

-   Siguenos en Facebook, Twitter, Youtube y TikTok como:

    ::: {style="color: gray;"}
    @ergostats
    :::

## Contenido üìë

-   Al final de este webinar tu ser√°s capaz de:

    -   Estimar valores poblacionales de **medias, proporciones, totales, y cuantiles**

    -   Implementar pruebas **T**

    -   Ajustar un modelo de regresion lineal

-   No cubriremos a detalle:

    -   Ponderaci√≥n, calibraci√≥n y otros metodos de estimaci√≥n de modelos de regresi√≥n

## Herramientas

::: {.incremental style="color: gray;"}
-   R (\>= 4.0.0)

-   RStudio

-   GIT

-   Github

-   [Encuesta Estructural Empresarial](https://www.ecuadorencifras.gob.ec/encuesta-a-empresas/)

-   [Calidad de las encuestas (CEPAL)](https://www.cepal.org/sites/default/files/publication/files/45681/S2000293_es.pdf)
:::

## La ENESEM üè¢

La Encuesta Estructural Empresarial (ENESEM) tiene 2 objetivos:

::: columns
::: {.column width="50%"}
Calcular agregados econ√≥micos üí∏

-   Producci√≥n

-   Consumo intermedio

-   Valor agregado

-   Entre otros.
:::

::: {.column width="50%"}
Presentar informaci√≥n sobre: üßë‚Äçüè≠

-   Materias primas y productos elaborados

-   Mercader√≠as y servicios vendidos

-   Uso de tecnolog√≠as y comunicaci√≥n (TIC)
:::
:::

## Limites: üö®

-   La encuesta est√° dirigida a empresas.

-   Se incluyen todas las actividades econ√≥micas clasificadas con CIIU salvo por:

    -   ***A.*** Agricultura, ganader√≠a, silvicultura y pesca.

    -   ***O.*** Administraci√≥n p√∫blica y defensa; planes de seguridad social de afiliaci√≥n obligatoria.

    -   ***T.*** Actividades de los hogares como empleadores; actividades no diferenciadas de los hogares como productores de bienes y servicios para uso propio.

    -   ***U.*** Actividades de organizaciones y √≥rganos extraterritoriales

## √öltimos detalles:

::: incremental
-   **Universo de analisis**

    -   Las empresas de tama√±o grande, mediana A y mediana B que cumplen con los criterios de clasificaci√≥n de cobertura tem√°tica para el a√±o 2019.

-   **Unidades de analisis**

    -   Empresas

-   **Tipo de muestreo**

    -   Muestreo probabil√≠stico de elementos con selecci√≥n aleatoria.
:::

## Resumen oficial

![](images/paste-BF4E111F.png)

## Librerias a usar {auto-animate="true"}

```{r echo=TRUE}

# Para el manejo de las tablas, y verbos importantes
library(tidyverse)

```

## Librerias a usar {auto-animate="true"}

```{r echo=TRUE}
# Para el manejo de las tablas, y verbos importantes
library(tidyverse)

# Para el manejo de encuestas
library(srvyr)
library(survey)
```

## Librerias a usar {auto-animate="true"}

```{r echo=TRUE}
# Para el manejo de las tablas, y verbos importantes
library(tidyverse)

# Para el manejo de encuestas
library(srvyr)
library(survey)

# Para hacer tablas bonitas
library(gt)
```

## Librerias a usar {auto-animate="true"}

```{r echo=TRUE}
# Para el manejo de las tablas, y verbos importantes
library(tidyverse)

# Para el manejo de encuestas
library(srvyr)
library(survey)

# Para hacer tablas bonitas
library(gt)
```

Version de R:

```{r, echo=TRUE}

R.version
```

## Declarando la encuesta

De esta manera, un postestrato est√° conformado por las empresas que tienen un mismo tama√±o de empresa y secci√≥n econ√≥mica de acuerdo con el DIEE 2020, fragmentando los dominios originales de la muestra. [^2]

[^2]: Documento con el dise√±o muestral de la ENESEM

```{r, echo = TRUE,eval=FALSE}
objeto_survey <- enesem_tics_raw %>% 
  as_survey_design(ids = id_empresa,
                   weights = f_exp,
                   strata = c(----))
```

## Estadisticas descriptivas üëæ

1\. Crear un objeto `tbl_svy` usando: `as_survey_design`

2\. Subconjunto de datos (si es necesario) usando `filter` (subpoblaciones)

3\. Especificar dominios de an√°lisis usando `group_by`

4\. Dentro de `summarize`, especificamos variables para calcular incluyendo medias, totales, proporciones, cuantiles y m√°s

## Las funciones que nos van a ayudar

-   Funciones a tener en cuenta:

-   `survey_mean`

-   `survey_total` (sumas totales)

-   `survey_median`

-   `survey_quantile`

-   `survey_ratio`

## Inversi√≥n en TIC promedio por sector econ√≥mico

```{r, echo = TRUE,eval=FALSE}

survey_mean(
  x,
  na.rm = FALSE,
  vartype = c("se","ci","var","cv"),
  level = 0.95,
  proportion = FALSE,
  deff = FALSE,
  df = NULL,
  ...
)

```

## Total de personas empleadas por medianas y grandes empresas en Ecuador

```{r, echo = TRUE,eval=FALSE}
survey_total(
  x,
  na.rm = FALSE,
  vartype = c("se", "ci", "var", "cv"),
  level = 0.95,
  deff = FALSE,
  df = NULL,
  ...
)
```

## Primer y tercer quantil de inversion en TIC

```{r, echo = TRUE,eval=FALSE}
survey_quantile(
  x,
  quantiles,
  na.rm = FALSE,
  vartype = c("se","ci","var","cv"),
  level = 0.95,
  df = NULL,
  ...
)

```

## Ventas promedio en relaci√≥n a la inversi√≥n en TIC

```{r, echo = TRUE,eval=FALSE}

survey_ratio(
  numerator,
  denominator,
  na.rm = FALSE,
  vartype = c("se","ci","var","cv"),
  level = 0.95,
  deff = FALSE,
  df = NULL,
  ...
)


```

## El retorno de la inversion en TIC

```{r, eval = FALSE, echo = TRUE}

roi <-   enesem_tics_raw %>% 
  mutate(personal = tic2_5_pers_ocup_h + tic2_5_pers_ocup_m,
         indicador = 	(tic3_1_1_ventas - tic3_2_1_compras - tic1_2)/tic1_2)
```
