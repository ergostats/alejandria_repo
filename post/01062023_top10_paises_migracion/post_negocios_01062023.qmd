---
title: "Migración y motivos"
format: html
editor: visual
---

# Objetivo

Queremos construir un mapa temático o *coroplético* del mundo, que indique **el número salidas de ecuatorianos mayores de 18 años por motivos de negocios**.

# Cargamos librerias:

```{r, message=FALSE,warning=FALSE}

library(tidyverse)
library(haven)
library(gganimate)
library(gifski)

```

# Con que versión de R trabajamos

```{r}
R.version
```

# Metadato (bases crudas)

En la carpeta:

```{r}

ruta_local <- "../migracion/data/"
  
```

# Descarga y lectura de las bases de datos:

### Descarga

Se descarga la base de datos del Registro de Entradas y Salidas Internacionales (ESI) del enlace:

<https://www.ecuadorencifras.gob.ec/entradas-y-salidas-internacionales/>

Y se realizaron las siguientes acciones:

-   Descarga en formato `.dta`

-   Descompresión en un proyecto local de R

-   Re ubicación del archivo con la base de datos dentro del directorio `data/` en un proyecto local de R

### Lectura

```{r,eval=TRUE,echo=FALSE}
base_datos <- read_tsv("top_10_mensual.txt")

```

# Modificamos las bases de datos:

Agregamos una nueva variable que nos indica la posición del país en el top 10:

```{r}
base_datos <- base_datos %>%
  mutate(rank=rep(seq(1,10,by=1),12))
  
```

# Gráfico:

### El gráfico del tema:

```{r}
graficos_estaticos <- ggplot(data = base_datos,
                             aes(x = rank,
                                 group = pais_prod,
                                 fill = as.factor(pais_prod),
                                 color = as.factor(pais_prod)))+
  geom_tile(aes(y = acum/2,
                height = acum,
                width = 0.9),alpha=0.8,color=NA)+
  geom_text(aes(y=0,label=paste(pais_prod," ")),vjust = 0.2, hjust = 1)+
  geom_text(aes(y=trunc(acum),label= trunc(acum),hjust=0))+
  coord_flip(clip = "off", expand = FALSE)+
  scale_y_continuous(labels = scales::comma)+
  scale_x_reverse()+
  guides(color = none, fill = none)

```

### Añadimos el tema para que cuadre con la publicación

```{r}
graficos_estaticos <- graficos_estaticos +
  theme(axis.line=element_blank(),
        axis.text.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks=element_blank(),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        legend.position="none",
        panel.background=element_blank(),
        panel.border=element_blank(),
        panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        panel.grid.major.x = element_line( size=.1, color="grey" ),
        panel.grid.minor.x = element_line( size=.1, color="grey" ),
        plot.title=element_text(size=25, hjust=0.5, face="bold", colour="black", vjust=-1),
        plot.subtitle=element_text(size=18, hjust=0.5, face="italic", color="black"),
        plot.caption =element_text(size=8, hjust=0.5, face="italic", color="black"),
        plot.background=element_blank(),
        plot.margin = margin(2,2, 2, 5, "cm"))
  
```

### Añadimos los títulos

```{r}
anim = graficos_estaticos + transition_states(mes_movi, transition_length = 4, state_length = 1) +
  view_follow(fixed_x = TRUE)  +
  labs(title = 'Migracion por motivo de residencia : ',  
       subtitle  =  "Top 10 Paises del año 2021",
       caption  = "Salidas de ecuatorianos | Data Source: ESI(INEC)")
```

### Últimos detalles

```{r}
animate(anim, 300, fps = 20,  width = 1200, height = 1000, 
        renderer = gifski_renderer("gganim.gif"))
```

# Ultima cifra

```{r}

conteo_pais_2 <- base_datos %>%
    filter(tip_movi == 2,            # Salidas
           tip_naci == 1,            # De ecuatorianos
           edad > 18) %>%            # Mayores de 18 años
    count(pais_prod,name = "total_salidas") %>% 
    mutate(iso_n3 = str_pad(pais_prod,3,pad = "0"))

n1 <- conteo_pais_2 %>% pull(total_salidas) %>% sum()

n2 <- conteo_pais %>% pull(n) %>% sum()
```

# Guión

### Conceptos

-   **Salidas de ecuatorianos por motivos de negocios:** Consideramos las salidas de ecuatorianos mayores de 18 años. La estancia máxima, generalmente, es de 90 días por año, sin embargo existen excepciones como el convenio Schengen o el convenio de países de la UNASUR.

-   **Negocios:** El visado por motivos de negocios depende de cada país. Algunos requisitos suelen ser: pasaporte válido, carta de invitación de la empresa u organización, antecedentes de la actividad laboral que se realiza, entre otros. Se recomienda visitar la página del consulado del país al que desear ir para conocer los requisitos específicos.

### Estadísticas claves

-   Más del 50% de las salidas por motivos de negocio tienen como destino a países sudamericanos como Perú y Colombia, a los cuales se puede ingresar solamente con la cédula de identidad. En América del Norte, Estados Unidos y México concentran alrededor del 28% de salidas.

-   España es el país europeo con mayor tránsito por motivos de negocio, sin embargo el resto de este continente no es muy visitado por este motivo.

-   Las salidas por negocios (`r scales::number(n2)`) representan el `r scales::percent(n2/n1)` del total de las salidas de ecuatorianos mayores a 18 años (`r scales::number(n1)`)

# Citas

https://gt.rstudio.com/reference/ggplot_image.html

https://github.com/ropensci/rnaturalearth

https://tidyverse.org
