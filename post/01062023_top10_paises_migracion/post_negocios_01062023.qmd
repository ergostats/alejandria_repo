---
title: "Migración y motivos"
format: html
editor: visual
---

# Objetivo

Queremos construir un gráfico de barras animado, que indique **el top 10 de países a donde migraron los ecuatorianos por motivo de residencia.**

# Cargamos librerias:

```{r, message=FALSE,warning=FALSE}

library(tidyverse)
library(haven)
library(gganimate)
library(gifski)

```

# Con que versión de R trabajamos

```{r}
R.version
```

# Metadato (bases crudas)

En la carpeta:

```{r}

ruta_local <- "../migracion/data/"
  
```

# Descarga y lectura de las bases de datos:

### Descarga

Se descarga la base de datos del Registro de Entradas y Salidas Internacionales (ESI) del enlace:

<https://www.ecuadorencifras.gob.ec/entradas-y-salidas-internacionales/>

Y se realizaron las siguientes acciones:

-   Descarga en formato `.dta`

-   Descompresión en un proyecto local de R

-   Re ubicación del archivo con la base de datos dentro del directorio `data/` en un proyecto local de R

### Lectura

```{r,eval=TRUE,echo=FALSE}
base_datos <- read_tsv("top_10_mensual_estudios.txt")

```

# Modificamos las bases de datos:

Filtro para más allá de 2014:

```{r}
base_datos <- base_datos %>%
  filter(anio_movi >= 2014) 
  
```

Crear variable de fecha:

```{r}
base_datos <- base_datos %>%
  mutate(fecha = make_date(year = anio_movi,
                           month = mes_movi,
                           day = 1)) 

```

# Gráfico:

### El gráfico del tema:

```{r}
graficos_estaticos <- ggplot(data = base_datos,
                             aes(x = rank,
                                 group = homologada,
                                 fill = as.factor(homologada),
                                 color = as.factor(homologada)))+
  geom_tile(aes(y = acum/2,
                height = acum,
                width = 0.9),alpha=0.8,color=NA)+
  geom_text(aes(y=0,label=paste(homologada," ")),vjust = 0.2, hjust = 1)+
  geom_text(aes(y=trunc(acum),label= trunc(acum),hjust=0))+
  coord_flip(clip = "off", expand = FALSE)+
  scale_y_continuous(labels = scales::comma)+
  scale_x_reverse()+
  guides(color = none, fill = none)

```

### Añadimos el tema para que cuadre con la publicación

```{r}
graficos_estaticos <- graficos_estaticos +
  theme(axis.line=element_blank(),
        axis.text.x=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks=element_blank(),
        axis.title.x=element_blank(),
        axis.title.y=element_blank(),
        legend.position="none",
        panel.background=element_blank(),
        panel.border=element_blank(),
        panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        panel.grid.major.x = element_line( size=.1, color="grey" ),
        panel.grid.minor.x = element_line( size=.1, color="grey" ),
        plot.title=element_text(size=25, hjust=0.5, face="bold", colour="black", vjust=-1),
        plot.subtitle=element_text(size=18, hjust=0.5, face="italic", color="black"),
        plot.caption =element_text(size=8, hjust=0.5, face="italic", color="black"),
        plot.background=element_blank(),
        plot.margin = margin(2,2, 2, 5, "cm"))
  
```

### Añadimos los títulos

```{r}
anim = graficos_estaticos + transition_states(fecha, transition_length = 4, state_length = 1) +
  view_follow(fixed_x = TRUE)  +
  labs(title = 'Migracion por motivo de residencia : ',  
       subtitle  =  "Fecha: {current_frame}",
       caption  = "Salidas de ecuatorianos | Data Source: ESI(INEC)")
```

### Últimos detalles

```{r}
animate(anim, 300, fps = 20,  width = 1200, height = 1000, 
        renderer = gifski_renderer("gganim.gif"))
```

# Cifras de interes

1\. En promedio ¿En que año se dio el menor numero de salidas del país por este motivo?

2\. Durante el 2020 cual fue:

-   El mes de menor salidas y cuantas fueron

-   Cuales fueron los meses de mayor restricción a las salidas en 2020

3.  Noticias relevantes sobre la migración por los motivos:
    -   Negocios
    -   Turismo
    -   Estudios
    -   Residencia

```{r}


```

# Guión

### Conceptos

-   **Salidas de ecuatorianos por motivos de negocios:** Consideramos las salidas de ecuatorianos mayores de 18 años. La estancia máxima, generalmente, es de 90 días por año, sin embargo existen excepciones como el convenio Schengen o el convenio de países de la UNASUR.

-   **Negocios:** El visado por motivos de negocios depende de cada país. Algunos requisitos suelen ser: pasaporte válido, carta de invitación de la empresa u organización, antecedentes de la actividad laboral que se realiza, entre otros. Se recomienda visitar la página del consulado del país al que desear ir para conocer los requisitos específicos.

### Estadísticas claves

-   Más del 50% de las salidas por motivos de negocio tienen como destino a países sudamericanos como Perú y Colombia, a los cuales se puede ingresar solamente con la cédula de identidad. En América del Norte, Estados Unidos y México concentran alrededor del 28% de salidas.

-   España es el país europeo con mayor tránsito por motivos de negocio, sin embargo el resto de este continente no es muy visitado por este motivo.

-   Las salidas por negocios (`r scales::number(n2)`) representan el `r scales::percent(n2/n1)` del total de las salidas de ecuatorianos mayores a 18 años (`r scales::number(n1)`)

# Citas

https://gt.rstudio.com/reference/ggplot_image.html

https://github.com/ropensci/rnaturalearth

https://tidyverse.org
